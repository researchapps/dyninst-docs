<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Abstractions &mdash; Dyninst 12.1.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sphinx-argparse.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Dyninst
          </a>
              <div class="version">
                12.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Dataflow API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dataflowAPI/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataflowAPI/index.html#abstractions">Abstractions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataflowAPI/index.html#examples">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataflowAPI/index.html#api-reference">API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">dynC API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dynC_API/index.html">DynC API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dynC_API/index.html#dync-language-description">DynC Language Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dynC_API/index.html#the-dyninst-domain">The Dyninst Domain</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Instruction API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../instructionAPI/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../instructionAPI/index.html#instructionapi-modules-and-abstractions">InstructionAPI Modules and Abstractions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../instructionAPI/index.html#instructionapi-class-reference">InstructionAPI Class Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parse API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../parseAPI/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parseAPI/index.html#abstractions">Abstractions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parseAPI/index.html#examples">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parseAPI/index.html#the-parsing-api">The Parsing API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parseAPI/index.html#extending-parseapi">Extending ParseAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parseAPI/index.html#defensive-mode-parsing">Defensive Mode Parsing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Patch API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html#abstractions">Abstractions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html#examples">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html#public-api-reference">Public API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html#modification-api-reference">Modification API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html#plugin-api-reference">Plugin API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html#patchapi-for-dyninst-programmers">PatchAPI for Dyninst Programmers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Stackwalk</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../stackwalk/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stackwalk/index.html#abstractions">Abstractions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stackwalk/index.html#api-reference">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stackwalk/index.html#callback-interface-default-implementations">Callback Interface Default Implementations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Symtab API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../symtabAPI/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symtabAPI/index.html#abstractions">Abstractions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symtabAPI/index.html#simple-examples">Simple Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symtabAPI/index.html#definitions-and-basic-types">Definitions and Basic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symtabAPI/index.html#namespace-symtabapi">Namespace SymtabAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symtabAPI/index.html#api-reference-symbol-table-interface">API Reference - Symbol Table Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symtabAPI/index.html#api-reference-line-number-interface">API Reference - Line Number Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symtabAPI/index.html#api-reference-type-interface">API Reference - Type Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symtabAPI/index.html#api-reference-dynamic-components">API Reference - Dynamic Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symtabAPI/index.html#building-symtabapi">Building SymtabAPI</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Dyninst</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Abstractions</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/patchAPI/section/2_abs.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="abstractions">
<span id="sec-abs"></span><h1>Abstractions<a class="headerlink" href="#abstractions" title="Permalink to this headline"></a></h1>
<div class="figure align-default" id="fig-abs">
<a class="reference internal image-reference" href="patchAPI/section/figure/abstraction/img.pdf"><img alt="Object Ownership" src="patchAPI/section/figure/abstraction/img.pdf" style="width: 85.0%;" /></a>
<p class="caption"><span class="caption-text">Object Ownership</span><a class="headerlink" href="#fig-abs" title="Permalink to this image"></a></p>
</div>
<p>PatchAPI contains two interfaces: the public interface and the plugin
interface. The public interface is used to find instrumentation points,
insert or delete code snippets, and register plugins provided by
programmers. The plugin interface is used to customize different aspects
in the binary code patching. PatchAPI provides a set of default plugins
for first party code patching, which is easy to extend to meet different
requirements in practice.</p>
<p>Figure <a class="reference external" href="#fig:abs">1</a> shows the ownership hierarchy for PatchAPI’s
classes. Ownership is a “contains” relationship. If one class owns
another, then instances of the owner class maintain exactly one or
possibly more than one instances of the other, which depends on whether
the relationship is a “1:1” or a “1:n” relationship. In Figure
<a class="reference external" href="#fig:abs">1</a>, for example, each PatchMgr instance contains exactly
one instance of a AddrSpace object, while a PatchMgr instance may
contains more than one instances of a Point object.</p>
<p>The remainder of this section briefly describes the classes that make up
PatchAPI’s two interfaces. For more details, see the class descriptions
in Section&nbsp;<a class="reference external" href="#sec-public-api">[sec-public-api]</a> and
Section&nbsp;<a class="reference external" href="#sec-plugin-api">[sec-plugin-api]</a>.</p>
<div class="section" id="public-interface">
<span id="sec-2-1"></span><h2>Public Interface<a class="headerlink" href="#public-interface" title="Permalink to this headline"></a></h2>
<p>PatchMgr, Point, and Snippet are used to perform the main process of
binary code patching: 1) find some <strong>Point</strong>; 2) insert or delete
<strong>Snippet</strong> at some <strong>Point</strong>.</p>
<ul class="simple">
<li><em>PatchMgr</em> - The PatchMgr class is the top-level class for finding
instrumentation <strong>Points</strong>, inserting or deleting <strong>Snippets</strong>, and
registering user-provided plugins.</li>
<li><em>Point</em> - The Point class represents a location on the CFG that acts
as a container of inserted snippet <strong>Instances</strong>. Points of different
types are distinct even the underlying code relocation and generation
engine happens to put instrumentation from them at the same place.</li>
<li><em>Instance</em> - The Instance class is a representation of a particular
snippet inserted at a particular point.</li>
<li><em>PatchObject</em> - The PatchObject class is a wrapper of ParseAPI’s
CodeObject class, which represents an individual binary code object,
such as an executable or a library.</li>
<li><em>PatchFunction</em> - The PatchFunction class is a wrapper of ParseAPI’s
Function class, which represents a function.</li>
<li><em>PatchBlock</em> - The PatchBlock class is a wrapper of ParseAPI’s Block
class, which represents a basic block.</li>
<li><em>PatchEdge</em> - The PatchEdge class is a wrapper of ParseAPI’s Edge
class, which join two basic blocks in the CFG, indicating the type of
control flow transfer instruction that joins the basic blocks to each
other.</li>
<li><em>PatchLoop</em> - The PatchLoop class is a wrapper of ParseAPI’s Loop
class, which repreents a piece of code that may execute repeatedly.</li>
<li><em>PatchLoopTreeNode</em> - The PatchLoopTreeNode class is a wrapper of
ParseAPI’s LoopTreeNode class, which provides a tree interface to a
collection of instances of class PatchLoop contained in a function.
The structure of the tree follows the nesting relationship of the
loops in a function.</li>
</ul>
</div>
<div class="section" id="plugin-interface">
<span id="sec-2-2"></span><h2>Plugin Interface<a class="headerlink" href="#plugin-interface" title="Permalink to this headline"></a></h2>
<p>The address space abstraction determines whether the code patching is
1st party, 3rd party or binary rewriting.</p>
<ul class="simple">
<li><em>AddrSpace</em> - The AddrSpace class represents the address space of a
<strong>Mutatee</strong> (a program that is instrumented), where it contains a
collection of <strong>PatchObjects</strong> that represent shared libraries or a
binary executable. In addition, programmers implement some memory
management interfaces in the AddrSpace class to determines the type
of the code patching - 1st party, 3rd party, or binary rewriting.</li>
</ul>
<p>Programmers can decide the representation of a <strong>Snippet</strong>, for example,
the representation can be in high level language (e.g., C or C++), or
can simply be in binary code (e.g., 0s and 1s).</p>
<ul class="simple">
<li><em>Snippet</em> - The Snippet class allows programmers to easily plug in
their own snippet representation and the corresponding mini-compiler
to translate the representation into the binary code.</li>
</ul>
<p>PatchAPI provides a thin layer on top of ParseAPI’s Control Flow Graph
(CFG) layer, which associates some useful information for the ease of
binary code patching, for example, a shared library’s load address. This
layer of CFG structures include PatchObject, PatchFunction, PatchBlock
and PatchEdge classes. Programmers can extend these four CFG classes,
and use the derived class of CFGMaker to build a CFG with the augmented
CFG structures.</p>
<ul class="simple">
<li><em>CFGMaker</em> - The CFGMaker class is a factory class that constructs
the above CFG structures. This class is used in CFG parsing.</li>
</ul>
<p>Similar to customizing the PatchAPI layer, programmers can also
customize the Point class by extending it.</p>
<ul class="simple">
<li><em>PointMaker</em> - The PointMaker class is a factory class that
constructs a subclass of the Point class.</li>
</ul>
<div class="figure align-default" id="fig-inh">
<a class="reference internal image-reference" href="patchAPI/section/figure/command/img.pdf"><img alt="Inheritance Hierarchy" src="patchAPI/section/figure/command/img.pdf" style="width: 85.0%;" /></a>
<p class="caption"><span class="caption-text">Inheritance Hierarchy</span><a class="headerlink" href="#fig-inh" title="Permalink to this image"></a></p>
</div>
<p>The implementation of an instrumentation engine may be very
sophisticated (e.g., relocating a function), or very simple (e.g.,
simply overwrite an instruction). Therefore, PatchAPI provides a
flexible framework for programmers to customize the instrumentation
engine. This framework is based on Command Pattern&nbsp; <a class="footnote-reference" href="#id2" id="id1">[1]</a>. The
instrumentation engine has transactional semantics, where all
instrumentation requests should succeed or all should fail. In our
framework, the <strong>Command</strong> abstraction represents an instrumentation
request or a logical step in the code patching process. We accumulate a
list of <strong>Commands</strong>, and execute them one by one. If one <strong>Command</strong>
fails, we undo all preceding finished <strong>Commands</strong>. Figure
<a class="reference external" href="#fig:inh">2</a> illustrates the inheritance hierarchy for related
classes. There is a default implementation of instrumentation engine in
PatchAPI for 1st party code patching.</p>
<ul class="simple">
<li><em>Command</em> - The Command class represents an instrumentation request
(e.g., snippet insertion or removal), or a logical step in the code
patching (e.g., install instrumentation). This class provides a run()
method and an undo() method, where run() will be called for normal
execution, and undo() will be called for undoing this Command.</li>
<li><em>BatchCommand</em> - The BatchCommand class is a subclass of Command, and
it is in fact a container of a list of Commands to be executed
atomically.</li>
<li><em>Instrumenter</em> - The Instrumenter class inherits BatchCommand to
encapsulate the core code patching logic, which includes binary code
generation. Instrumenter would contain several logical steps that are
individual Commands.</li>
<li><em>Patcher</em> - The Patcher class is also a subclass of BatchCommand. It
accepts instrumentation requests from users, where these
instrumentation requests are Commands (e.g., snippet insertion).
Furthermore, Patcher implicitly adds Instrumenter to the end of the
Command list to generate binary code and install the instrumentation.</li>
</ul>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><a class="reference external" href="http://en.wikipedia.org/wiki/Command_pattern">http://en.wikipedia.org/wiki/Command_pattern</a></td></tr>
</tbody>
</table>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 1996-2022, Barton P. Miller.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>