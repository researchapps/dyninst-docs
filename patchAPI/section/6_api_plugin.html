<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Plugin API Reference &mdash; Dyninst 12.1.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sphinx-argparse.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Dyninst
          </a>
              <div class="version">
                12.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The Dataflow API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dataflowAPI/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataflowAPI/index.html#abstractions">Abstractions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataflowAPI/index.html#examples">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataflowAPI/index.html#api-reference">API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">dynC API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dynC_API/index.html">DynC API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dynC_API/index.html#dync-language-description">DynC Language Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dynC_API/index.html#the-dyninst-domain">The Dyninst Domain</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Instruction API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../instructionAPI/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../instructionAPI/index.html#instructionapi-modules-and-abstractions">InstructionAPI Modules and Abstractions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../instructionAPI/index.html#instructionapi-class-reference">InstructionAPI Class Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Parse API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../parseAPI/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parseAPI/index.html#abstractions">Abstractions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parseAPI/index.html#examples">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parseAPI/index.html#the-parsing-api">The Parsing API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parseAPI/index.html#extending-parseapi">Extending ParseAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parseAPI/index.html#defensive-mode-parsing">Defensive Mode Parsing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Patch API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html#abstractions">Abstractions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html#examples">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html#public-api-reference">Public API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html#modification-api-reference">Modification API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html#plugin-api-reference">Plugin API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html#patchapi-for-dyninst-programmers">PatchAPI for Dyninst Programmers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Stackwalk</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../stackwalk/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stackwalk/index.html#abstractions">Abstractions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stackwalk/index.html#api-reference">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stackwalk/index.html#callback-interface-default-implementations">Callback Interface Default Implementations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Symtab API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../symtabAPI/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symtabAPI/index.html#abstractions">Abstractions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symtabAPI/index.html#simple-examples">Simple Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symtabAPI/index.html#definitions-and-basic-types">Definitions and Basic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symtabAPI/index.html#namespace-symtabapi">Namespace SymtabAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symtabAPI/index.html#api-reference-symbol-table-interface">API Reference - Symbol Table Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symtabAPI/index.html#api-reference-line-number-interface">API Reference - Line Number Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symtabAPI/index.html#api-reference-type-interface">API Reference - Type Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symtabAPI/index.html#api-reference-dynamic-components">API Reference - Dynamic Components</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Dyninst</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Plugin API Reference</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/patchAPI/section/6_api_plugin.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="plugin-api-reference">
<span id="sec-plugin-api"></span><h1>Plugin API Reference<a class="headerlink" href="#plugin-api-reference" title="Permalink to this headline"></a></h1>
<p>This section describes the various plugin interfaces for extending
PatchAPI. We expect that most users should not have to ever explicitly
use an interface from this section; instead, they will use plugins
previously implemented by PatchAPI developers.</p>
<p>As with the public interface, all objects and methods in this section
are in the “Dyninst::PatchAPI” namespace.</p>
<div class="section" id="addrspace">
<span id="sec-3-2-1"></span><h2>AddrSpace<a class="headerlink" href="#addrspace" title="Permalink to this headline"></a></h2>
<p><strong>Declared in</strong>: AddrSpace.h</p>
<p>The AddrSpace class represents the address space of a <strong>Mutatee</strong>, where
it contains a collection of <strong>PatchObjects</strong> that represent shared
libraries or a binary executable. In addition, programmers implement
some memory management interfaces in the AddrSpace class to determine
the type of the code patching - 1st party, 3rd party, or binary
rewriting.</p>
<div class="apient container">
virtual bool write(PatchObject* obj, Address to, Address from,
size_t size);</div>
<div class="apient container">
virtual Address malloc(PatchObject* obj, size_t size, Address near);</div>
<div class="apient container">
virtual Address realloc(PatchObject* obj, Address orig, size_t
size);</div>
<div class="apient container">
virtual bool free(PatchObject* obj, Address orig);</div>
<div class="apient container">
virtual bool loadObject(PatchObject* obj);</div>
<div class="apient container">
<p>typedef std::map&lt;const ParseAPI::CodeObject*, PatchObject*&gt;
AddrSpace::ObjMap;</p>
<p>ObjMap&amp; objMap();</p>
</div>
<div class="apient container">
PatchObject* executable();</div>
<div class="apient container">
PatchMgrPtr mgr();</div>
</div>
<div class="section" id="snippet">
<span id="sec-3-2-2"></span><h2>Snippet<a class="headerlink" href="#snippet" title="Permalink to this headline"></a></h2>
<p><strong>Declared in</strong>: Snippet.h</p>
<p>The Snippet class allows programmers to customize their own snippet
representation and the corresponding mini-compiler to translate the
representation into the binary code.</p>
<div class="apient container">
static Ptr create(Snippet* a);</div>
<div class="apient container">
virtual bool generate(Point *pt, Buffer &amp;buf);</div>
</div>
<div class="section" id="command">
<span id="sec-3-2-3"></span><h2>Command<a class="headerlink" href="#command" title="Permalink to this headline"></a></h2>
<p><strong>Declared in</strong>: Command.h</p>
<p>The Command class represents an instrumentation request (e.g., snippet
insertion or removal), or an internal logical step in the code patching
(e.g., install instrumentation).</p>
<div class="apient container">
virtual bool run() = 0;</div>
<div class="apient container">
virtual bool undo() = 0;</div>
<div class="apient container">
virtual bool commit();</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">run</span><span class="p">())</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">true</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="n">undo</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="batchcommand">
<span id="sec-3-2-4"></span><h2>BatchCommand<a class="headerlink" href="#batchcommand" title="Permalink to this headline"></a></h2>
<p><strong>Declared in</strong>: Command.h</p>
<p>The BatchCommand class inherits from the Command class. It is actually a
container of a list of Commands that will be executed in a transaction:
all Commands will succeed, or all will fail.</p>
<div class="apient container">
<p>typedef std::list&lt;CommandPtr&gt; CommandList;</p>
<p>CommandList <a href="#id1"><span class="problematic" id="id2">to_do_</span></a>; CommandList <a href="#id3"><span class="problematic" id="id4">done_</span></a>;</p>
</div>
<div class="apient container">
virtual bool run(); virtual bool undo();</div>
<div class="apient container">
void add(CommandPtr command);</div>
<div class="apient container">
void remove(CommandList::iterator iter);</div>
</div>
<div class="section" id="instrumenter">
<span id="sec-3-2-5"></span><h2>Instrumenter<a class="headerlink" href="#instrumenter" title="Permalink to this headline"></a></h2>
<p><strong>Declared in</strong>: Command.h</p>
<p>The Instrumenter class inherits BatchCommand to encapsulate the core
code patching logic, which includes binary code generation. Instrumenter
would contain several logical steps that are individual Commands.</p>
<div class="apient container">
CommandList <a href="#id5"><span class="problematic" id="id6">user_commands_</span></a>;</div>
<div class="apient container">
static InstrumenterPtr create(AddrSpacePtr as);</div>
<div class="apient container">
virtual bool replaceFunction(PatchFunction* oldfunc, PatchFunction*
newfunc);</div>
<div class="apient container">
virtual bool revertReplacedFunction(PatchFunction* oldfunc);</div>
<div class="apient container">
typedef std::map&lt;PatchFunction*, PatchFunction*&gt; FuncModMap;</div>
<div class="apient container">
virtual FuncModMap&amp; funcRepMap();</div>
<div class="apient container">
virtual bool wrapFunction(PatchFunction* oldfunc, PatchFunction*
newfunc, string name);</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="o">*</span><span class="n">malloc_wrapper</span><span class="p">(</span><span class="nb">int</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">do</span> <span class="n">stuff</span>
  <span class="n">void</span> <span class="o">*</span><span class="n">ret</span> <span class="o">=</span> <span class="n">malloc_clone</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
  <span class="o">//</span> <span class="n">do</span> <span class="n">more</span> <span class="n">stuff</span>
  <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="apient container">
virtual bool revertWrappedFunction(PatchFunction* oldfunc);</div>
<div class="apient container">
virtual FuncModMap&amp; funcWrapMap();</div>
<div class="apient container">
bool modifyCall(PatchBlock *callBlock, PatchFunction *newCallee,
PatchFunction *context = NULL);</div>
<div class="apient container">
bool revertModifiedCall(PatchBlock *callBlock, PatchFunction
*context = NULL);</div>
<div class="apient container">
bool removeCall(PatchBlock *callBlock, PatchFunction *context =
NULL);</div>
<div class="apient container">
typedef map&lt;PatchBlock*, // B : A call block map&lt;PatchFunction*, //
F_c: Function context PatchFunction*&gt; // F : The function to be
replaced &gt; CallModMap;</div>
<div class="apient container">
CallModMap&amp; callModMap();</div>
<div class="apient container">
AddrSpacePtr as() const;</div>
</div>
<div class="section" id="patcher">
<span id="sec-3-2-6"></span><h2>Patcher<a class="headerlink" href="#patcher" title="Permalink to this headline"></a></h2>
<p><strong>Declared in</strong>: Command.h</p>
<p>The class Patcher inherits from the class BatchCommand. It accepts
instrumentation requests from users, where these instrumentation
requests are Commands (e.g., snippet insertion). Furthermore, Patcher
implicitly adds an instance of Instrumenter to the end of the Command
list to generate binary code and install the instrumentation.</p>
<div class="apient container">
Patcher(PatchMgrPtr mgr)</div>
<div class="apient container">
virtual bool run();</div>
</div>
<div class="section" id="cfgmaker">
<span id="sec-3-2-12"></span><h2>CFGMaker<a class="headerlink" href="#cfgmaker" title="Permalink to this headline"></a></h2>
<p><strong>Declared in</strong>: CFGMaker.h</p>
<p>The CFGMaker class is a factory class that constructs the above CFG
structures (PatchFunction, PatchBlock, and PatchEdge). The methods in
this class are used by PatchObject. Programmers can extend
PatchFunction, PatchBlock and PatchEdge by annotating their own data,
and then use this class to instantiate these CFG structures.</p>
<div class="apient container">
<p>virtual PatchFunction* makeFunction(ParseAPI::Function* func,
PatchObject* obj); virtual PatchFunction*
copyFunction(PatchFunction* func, PatchObject* obj);</p>
<p>virtual PatchBlock* makeBlock(ParseAPI::Block* blk, PatchObject*
obj); virtual PatchBlock* copyBlock(PatchBlock* blk, PatchObject*
obj);</p>
<p>virtual PatchEdge* makeEdge(ParseAPI::Edge* edge, PatchBlock* src,
PatchBlock* trg, PatchObject* obj); virtual PatchEdge*
copyEdge(PatchEdge* edge, PatchObject* obj);</p>
</div>
</div>
<div class="section" id="pointmaker">
<span id="sec-3-2-13"></span><h2>PointMaker<a class="headerlink" href="#pointmaker" title="Permalink to this headline"></a></h2>
<p><strong>Declared in</strong>: Point.h</p>
<p>The PointMaker class is a factory class that constructs instances of the
Point class. The methods of the PointMaker class are invoked by
PatchMgr’s findPoint methods. Programmers can extend the Point class,
and then implement a set of virtual methods in this class to instantiate
the subclasses of Point.</p>
<div class="apient container">
PointMaker(PatchMgrPtr mgr);</div>
<div class="apient container">
virtual Point *mkFuncPoint(Point::Type t, PatchMgrPtr m,
PatchFunction *f); virtual Point *mkFuncSitePoint(Point::Type t,
PatchMgrPtr m, PatchFunction *f, PatchBlock *b); virtual Point
*mkBlockPoint(Point::Type t, PatchMgrPtr m, PatchBlock *b,
PatchFunction *context); virtual Point *mkInsnPoint(Point::Type t,
PatchMgrPtr m, PatchBlock *, Address a,
InstructionAPI::Instruction::Ptr i, PatchFunction *context); virtual
Point *mkEdgePoint(Point::Type t, PatchMgrPtr m, PatchEdge *e,
PatchFunction *context);</div>
</div>
<div class="section" id="default-plugin">
<span id="sec-3-3"></span><h2>Default Plugin<a class="headerlink" href="#default-plugin" title="Permalink to this headline"></a></h2>
</div>
<div class="section" id="pushfrontcommand-and-pushbackcommand">
<span id="sec-3-3-1"></span><h2>PushFrontCommand and PushBackCommand<a class="headerlink" href="#pushfrontcommand-and-pushbackcommand" title="Permalink to this headline"></a></h2>
<p><strong>Declared in</strong>: Command.h</p>
<p>The class PushFrontCommand and the class PushBackCommand inherit from
the Command class. They are to insert a snippet to a point. A point
maintains a list of snippet instances. PushFrontCommand would add the
new snippet instance to the front of the list, while PushBackCommand
would add to the end of the list.</p>
<div class="apient container">
static Ptr create(Point* pt, SnippetPtr snip);</div>
<div class="apient container">
InstancePtr instance();</div>
</div>
<div class="section" id="removesnippetcommand">
<span id="sec-3-3-2"></span><h2>RemoveSnippetCommand<a class="headerlink" href="#removesnippetcommand" title="Permalink to this headline"></a></h2>
<p><strong>Declared in</strong>: Command.h</p>
<p>The class RemoveSnippetCommand inherits from the Command class. It is to
delete a snippet Instance.</p>
<div class="apient container">
static Ptr create(InstancePtr instance);</div>
</div>
<div class="section" id="removecallcommand">
<span id="sec-3-3-3"></span><h2>RemoveCallCommand<a class="headerlink" href="#removecallcommand" title="Permalink to this headline"></a></h2>
<p><strong>Declared in</strong>: Command.h</p>
<p>The class RemoveCallCommand inherits from the class Command. It is to
remove a function call.</p>
<div class="apient container">
static Ptr create(PatchMgrPtr mgr, PatchBlock* call_block,
PatchFunction* context = NULL);</div>
</div>
<div class="section" id="replacecallcommand">
<span id="sec-3-3-4"></span><h2>ReplaceCallCommand<a class="headerlink" href="#replacecallcommand" title="Permalink to this headline"></a></h2>
<p><strong>Declared in</strong>: Command.h</p>
<p>The class ReplaceCallCommand inherits from the class Command. It is to
replace a function call with another function.</p>
<div class="apient container">
static Ptr create(PatchMgrPtr mgr, PatchBlock* call_block,
PatchFunction* new_callee, PatchFunction* context);</div>
</div>
<div class="section" id="replacefunccommand">
<span id="sec-3-3-5"></span><h2>ReplaceFuncCommand<a class="headerlink" href="#replacefunccommand" title="Permalink to this headline"></a></h2>
<p><strong>Declared in</strong>: Command.h</p>
<p>The class ReplaceFuncCommand inherits from the class Command. It is to
replace an old function with the new one.</p>
<div class="apient container">
static Ptr create(PatchMgrPtr mgr, PatchFunction* old_func,
PatchFunction* new_func);</div>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 1996-2022, Barton P. Miller.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>